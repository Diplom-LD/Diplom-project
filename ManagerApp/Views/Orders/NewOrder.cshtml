@{
    ViewData["Title"] = "New order";
}

@section Styles {
    <link rel="stylesheet" href="~/css/BTUCalculator.css" />
    <link rel="stylesheet" href="~/css/NewOrderStyle.css" />
}

<div class="order-form">
    <h2>New Order</h2>
    <form action="#" method="POST" id="orderForm">
        @Html.AntiForgeryToken()
        <fieldset>
            <legend>Order Details</legend>

            <label for="OrderType">Order Type</label>
            <select name="OrderType" id="OrderType" required>
                <option value="Installation">Installation</option>
                <option value="Maintenance">Maintenance</option>
            </select>

            <label for="WorkCost">Work Cost (MDL)</label>
            <input type="number" name="WorkCost" id="WorkCost" placeholder="Enter amount" required>

            <label for="PaymentMethod">Payment Method</label>
            <select id="PaymentMethod" name="PaymentMethod" required>
                <option value="MasterCard">MasterCard</option>
                <option value="Visa">Visa</option>
                <option value="Cash">Cash</option>
            </select>


            <div class="date-input-group">
                <label for="InstallationDate">Installation Date</label>
                <input type="datetime-local" id="InstallationDate" name="InstallationDate" required>
            </div>

            <label for="AddressInstallation">Installation Address</label>
            <input type="text" name="AddressInstallation" id="AddressInstallation" placeholder="Enter installation address" required>

            <label for="Notes">Notes</label>
            <textarea name="Notes" id="Notes" placeholder="Client/Manager Notes"></textarea>
        </fieldset>

        <fieldset>
            <legend>Client Information</legend>

            <label for="FullName">Full Name</label>
            <input type="text" name="FullName" id="FullName" placeholder="Client's full name" required>

            <label for="PhoneNumber">Phone Number</label>
            <input type="tel" name="PhoneNumber" id="PhoneNumber" placeholder="+373..." required>

            <label for="Email">Email</label>
            <input type="email" name="Email" id="Email" placeholder="example@email.com">
        </fieldset>

        <fieldset id="equipmentSection">
            <legend>Equipment Information</legend>

            <label for="EquipmentSource">Select Equipment Source</label>
            <select name="EquipmentSource" id="EquipmentSource" required>
                <option value="Warehouse">Warehouse</option>
                <option value="Store">Store</option>
            </select>

            <!-- Поля для Warehouse -->
            <div id="warehouseFields">
                <label for="Filter">Filter by</label>
                <div class="filters-container">
                    <select id="Filter">
                        <option value="">All</option>
                        <option value="BTU">BTU</option>
                        <option value="ServiceArea">Service Area (m²)</option>
                        <option value="Price">Price (MDL)</option>
                    </select>

                    <select id="SortOrder">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </div>

                <label for="WarehouseModel">Select Model</label>
                <select name="WarehouseModel" id="WarehouseModel" data-required>
                    <option value="">Select Model</option>
                </select>

                <label for="RequestedQuantity">Requested Quantity</label>
                <input type="number" name="RequestedQuantity" id="RequestedQuantity" data-required min="1">
            </div>

            <!-- Поля для Store -->
            <div id="storeFields" class="hidden">
                <label for="StoreModelName">Model Name</label>
                <input type="text" name="StoreModelName" id="StoreModelName" data-required>

                <label for="StoreName">Store Name</label>
                <input type="text" name="StoreName" id="StoreName" data-required>

                <label for="ModelUrl">Product URL</label>
                <input type="url" name="ModelUrl" id="ModelUrl" data-required>

                <label for="BTU">BTU</label>
                <input type="number" name="BTU" id="BTU" data-required>

                <label for="ServiceArea">Service Area (m²)</label>
                <input type="number" name="ServiceArea" id="ServiceArea" data-required>

                <label for="StorePrice">Price (MDL)</label>
                <input type="number" name="StorePrice" id="StorePrice" data-required>

                <label for="StoreQuantity">Quantity</label>
                <input type="number" name="StoreQuantity" id="StoreQuantity" data-required min="1">
            </div>

        </fieldset>

        <fieldset>
            <legend>Technician Selection</legend>

            <label for="TechnicianSelection">Assign Technicians</label>
            <select name="TechnicianSelection" id="TechnicianSelection">
                <option value="auto">Automatically Assign Nearest</option>
                <option value="manual">Select Manually</option>
            </select>

            <div id="manualTechnicianSelection" class="hidden">
                <label for="Technicians">Select Technicians</label>
                <select name="Technicians" id="Technicians" multiple></select>
                <div id="selectedTechniciansContainer" class="selected-items-container"></div>
            </div>
        </fieldset>

        <button type="submit">Create Order</button>
    </form>

    <!-- Floating Button -->
    <button id="openPopupBtn" class="floating-popup-btn">
        <ion-icon name="calculator-outline"></ion-icon>
    </button>

    <!-- Popup BTU Calculator & Conditioners -->
    <div id="btuPopup" class="popup hidden">
        <div class="popup-content">
            <div class="main-content">
                <div class="btu-calculator-card">
        <div class="btu-card-header">
            <h2>BTU Calculator</h2>
        </div>
        <form id="btuCalculatorForm">
            <!-- Основные поля -->
            <div class="btu-form-group">
                <label class="btu-label" for="roomSize">Room Size:</label>
                <div class="btu-input-group">
                    <input type="number" id="roomSize" class="btu-input" name="roomSize" placeholder="Enter size" required min="1" max="500" step="0.1">
                    <select id="sizeUnit" class="btu-select" name="sizeUnit">
                        <option value="square meters">square meters</option>
                        <option value="square feet">square feet</option>
                    </select>
                </div>
            </div>

            <div class="btu-form-group">
                <label class="btu-label" for="ceilingHeight">Ceiling Height:</label>
                <div class="btu-input-group">
                    <input type="number" id="ceilingHeight" class="btu-input" name="ceilingHeight" placeholder="Enter height" required min="2" max="10" step="0.1">
                    <select id="heightUnit" class="btu-select" name="heightUnit">
                        <option value="meters">meters</option>
                        <option value="feet">feet</option>
                    </select>
                </div>
            </div>

            <div class="btu-form-group">
                <label class="btu-label" for="peopleCount">Number of People:</label>
                <input type="number" id="peopleCount" class="btu-input" name="peopleCount" placeholder="Enter number" required min="1" max="100">
            </div>

            <div class="btu-form-group">
                <label class="btu-label" for="numberOfComputers">Number of Computers:</label>
                <input type="number" id="numberOfComputers" class="btu-input" name="numberOfComputers" placeholder="Enter number" required min="0" max="50">
            </div>

            <div class="btu-form-group">
                <label class="btu-label" for="numberOfTVs">Number of TVs:</label>
                <input type="number" id="numberOfTVs" class="btu-input" name="numberOfTVs" placeholder="Enter number" required min="0" max="50">
            </div>

            <div class="btu-form-group">
                <label class="btu-label" for="otherAppliancesKWattage">Other Appliances Power (kW):</label>
                <input type="number" id="otherAppliancesKWattage" class="btu-input" name="otherAppliancesKWattage" placeholder="Enter power in kW" required min="0" max="20" step="0.1">
            </div>

            <div class="btu-form-group">
                <label class="btu-label" for="sunExposure">Sun Exposure:</label>
                <select id="sunExposure" class="btu-select" name="sunExposure" required>
                    <option value="low">low</option>
                    <option value="medium" selected>medium</option>
                    <option value="high">high</option>
                </select>
            </div>

            <!-- Кнопка для отображения дополнительных параметров -->
            <label class="switch">
                <span class="toggle-label">Show Additional Parameters</span>
                <input type="checkbox" id="toggleParamsCheckbox" onchange="toggleParams()">
                <span class="slider round"></span>
            </label>


            <!-- Дополнительные параметры -->
            <div class="additional-params" id="additionalParams">
                <div class="btu-form-group">
                    <label class="btu-label" for="hasVentilation">Has Ventilation:</label>
                    <select id="hasVentilation" class="btu-select" name="hasVentilation" onchange="toggleVentilation()">
                        <option value="false" selected>No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>

                <div class="btu-form-group" id="airExchangeRateGroup" style="display: none;">
                    <label class="btu-label" for="airExchangeRate">Air Exchange Rate:</label>
                    <input type="number" step="0.1" id="airExchangeRate" class="btu-input" name="airExchangeRate" placeholder="Enter rate" min="0.5" max="3.0">
                </div>

                <div class="btu-form-group">
                    <label class="btu-label" for="guaranteed20Degrees">Guaranteed 20 Degrees:</label>
                    <select id="guaranteed20Degrees" class="btu-select" name="guaranteed20Degrees" required>
                        <option value="false" selected>No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>

                <div class="btu-form-group">
                    <label class="btu-label" for="isTopFloor">Is Top Floor:</label>
                    <select id="isTopFloor" class="btu-select" name="isTopFloor" required>
                        <option value="false" selected>No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>

                <div class="btu-form-group">
                    <label class="btu-label" for="hasLargeWindow">Has Large Window:</label>
                    <select id="hasLargeWindow" class="btu-select" name="hasLargeWindow" onchange="toggleWindowArea()">
                        <option value="false" selected>No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>

                <div class="btu-form-group" id="windowAreaGroup" style="display: none;">
                    <label class="btu-label" for="windowArea">Window Area (m²):</label>
                    <input type="number" id="windowArea" class="btu-input" name="windowArea" placeholder="Enter window area" min="0" max="100" step="0.1">
                </div>
            </div>

            <div id="btuValidationErrors" class="btu-validation-errors"></div>
            <div class="btu-form-buttons">
                <div class="btu-main-buttons">
                    <button type="submit" class="btu-calculate-btn">Calculate</button>
                    <button type="reset" class="btu-clear-btn">Clear</button>
                </div>
            </div>
        </form>

        <div class="btu-result-container">
            <h3 class="btu-result-header">Calculation Results:</h3>
            <p id="btuHint" class="btu-hint">Enter your room details and click "Calculate" to see the result.</p>

            <div id="btuResults" class="btu-result-content" style="display: none;">
                <div id="btuWarning" class="btu-warning"></div>
                <p><strong>Calculated BTU:</strong> <span id="calculatedBTU">-</span></p>
                <p><strong>Calculated Power (kW):</strong> <span id="calculatedPowerKW">-</span></p>

                <h4>Recommended Range:</h4>
                <p><strong>Lower BTU:</strong> <span id="recommendedBTULower">-</span></p>
                <p><strong>Upper BTU:</strong> <span id="recommendedBTUUpper">-</span></p>

                <p><strong>Lower Power (kW):</strong> <span id="recommendedKWLower">-</span></p>
                <p><strong>Upper Power (kW):</strong> <span id="recommendedKWUpper">-</span></p>
            </div>
        </div>

    </div>

    <!-- Conditioners List Section -->
    <div class="conditionersBTU">
        <div class="cardHeader">
            <h2>Conditioners</h2>
            <button type="button" class="btu-find-btn">Find</button>
        </div>

        <div class="conditioner-form">
            <div id="conditionersMessage" class="conditioners-message">
                ⚠️ Do the BTU calculation first!
            </div>

            <table id="conditionersTable" class="full-width-table" style="display: none;">
                <thead>
                    <tr>
                        <td>Name</td>
                        <td>Price</td>
                        <td>BTU</td>
                        <td>Service Area</td>
                        <td>Store</td>
                    </tr>
                </thead>
                <tbody id="conditionersTableBody" style="font-size: 0.8rem;"></tbody>
            </table>

            <div id="rangeMessageContainer" class="range-message" >
                ⚠️ Air conditioners with minimum BTU values are shown.
            </div>
        </div>
    </div>

            </div>
        </div>
    </div>
</div>

<script src="~/js/BTU/BTUCalculator.js"></script>
<script src="~/js/Orders/NewOrder.js"></script>
